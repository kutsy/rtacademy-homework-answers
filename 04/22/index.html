<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>#4.22</title>
    <link rel="stylesheet" href="./css/styles.css" media="all">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans+Extra+Condensed&display=swap" rel="stylesheet">
</head>
<body>

<header>
    <a href="./index.html" class="logo"><h1>Gaming News</h1></a>
    <nav>
        <ul>
            <li><a href="./category/pc">PC</a></li>
            <li><a href="./category/playstation">Playstation</a></li>
            <li><a href="./category/nintendo">Nintendo</a></li>
        </ul>
    </nav>
</header>

<main class="main-posts">
    <div class="top-article">
        TOP ARTICLE
        <a href="./nintendo-of-america-president-responds-to-reports-of-new-switch-hardware">Nintendo of America President Responds to Reports of New Switch Hardware</a>
    </div>

    <div class="posts">
        <article>
            <a href="./bayonetta-3-is-progressing-well-despite-its-no-show-at-e3-2021-nintendo-says" class="cover"><img src="./images/01_310.jpg"
                srcset="./images/01_310.jpg 310w, ./images/01_350.jpg 350w, ./images/01_550.jpg 550w, ./images/01_640.jpg 640w"
                sizes="(max-width: 48rem) 550px, (max-width: 62rem) 350px, (max-width: 75rem) 310px, 550px"
                alt="Bayonetta 3 Is 'Progressing Well' Despite Its No Show at E3 2021, Nintendo Says"></a>
            <a href="./bayonetta-3-is-progressing-well-despite-its-no-show-at-e3-2021-nintendo-says" class="title"><h2>Bayonetta 3 Is 'Progressing Well' Despite Its No Show at E3 2021, Nintendo Says</h2></a>
            <time datetime="2021-06-20T11:11:00">20.06.2021 11:11</time>
            <a href="./bayonetta-3-is-progressing-well-despite-its-no-show-at-e3-2021-nintendo-says" class="description">Bayonetta 3 was first announced at The Game Awards 2017.</a>
            <a href="./bayonetta-3-is-progressing-well-despite-its-no-show-at-e3-2021-nintendo-says" class="more">Continue Reading</a>
        </article>

        <article>
            <a href="./18-new-details-we-learned-from-the-sea-of-thieves-a-pirates-life-showcase" class="cover"><img src="./images/02_310.jpg"
               srcset="./images/02_310.jpg 310w, ./images/02_350.jpg 350w, ./images/02_550.jpg 550w, ./images/02_640.jpg 640w"
               sizes="(max-width: 48rem) 550px, (max-width: 62rem) 350px, (max-width: 75rem) 310px, 550px"
               alt="18 New Details We Learned From the Sea of Thieves: A Pirate's Life Showcase"></a>
            <a href="./18-new-details-we-learned-from-the-sea-of-thieves-a-pirates-life-showcase" class="title"><h2>18 New Details We Learned From the Sea of Thieves: A Pirate's Life Showcase</h2></a>
            <time datetime="2021-06-20T10:48:00">20.06.2021 10:48</time>
            <a href="./18-new-details-we-learned-from-the-sea-of-thieves-a-pirates-life-showcase" class="description">A Pirate's Life is a love letter to the Pirates of the Caribbean films and the Disneyland attraction.</a>
            <a href="./18-new-details-we-learned-from-the-sea-of-thieves-a-pirates-life-showcase" class="more">Continue Reading</a>
        </article>

        <article>
            <a href="./sony-wants-to-support-cross-play-more-playstation-boss-jim-ryan-says" class="cover"><img src="./images/03_310.jpg"
               srcset="./images/03_310.jpg 310w, ./images/03_350.jpg 350w, ./images/03_550.jpg 550w, ./images/03_640.jpg 640w"
               sizes="(max-width: 48rem) 550px, (max-width: 62rem) 350px, (max-width: 75rem) 310px, 550px"
               alt="Sony Wants to Support Cross-Play More, PlayStation Boss Jim Ryan Says"></a>
            <a href="./sony-wants-to-support-cross-play-more-playstation-boss-jim-ryan-says" class="title"><h2>Sony Wants to Support Cross-Play More, PlayStation Boss Jim Ryan Says</h2></a>
            <time datetime="2021-06-19T05:42:00">19.06.2021 05:42</time>
            <a href="./sony-wants-to-support-cross-play-more-playstation-boss-jim-ryan-says" class="description">"We support and encourage cross-play."</a>
            <a href="./sony-wants-to-support-cross-play-more-playstation-boss-jim-ryan-says" class="more">Continue Reading</a>
        </article>

        <article>
            <a href="./xbox-design-lab-returns-supports-next-gen-controller-designs" class="cover"><img src="./images/04_310.jpg"
               srcset="./images/04_310.jpg 310w, ./images/04_350.jpg 350w, ./images/04_550.jpg 550w, ./images/04_640.jpg 640w"
               sizes="(max-width: 48rem) 550px, (max-width: 62rem) 350px, (max-width: 75rem) 310px, 550px"
               alt="Xbox Design Lab Returns, Supports Next-Gen Controller Designs"></a>
            <a href="./xbox-design-lab-returns-supports-next-gen-controller-designs" class="title"><h2>Xbox Design Lab Returns, Supports Next-Gen Controller Designs</h2></a>
            <time datetime="2021-06-17T08:32:00">17.06.2021 08:32</time>
            <a href="./xbox-design-lab-returns-supports-next-gen-controller-designs" class="description">Design your custom Xbox Series X controller.</a>
            <a href="./xbox-design-lab-returns-supports-next-gen-controller-designs" class="more">Continue Reading</a>
        </article>

        <article>
            <a href="./bayonetta-3-is-progressing-well-despite-its-no-show-at-e3-2021-nintendo-says" class="cover"><img src="./images/05_310.jpg"
               srcset="./images/05_310.jpg 310w, ./images/05_350.jpg 350w, ./images/05_550.jpg 550w, ./images/05_640.jpg 640w"
               sizes="(max-width: 48rem) 550px, (max-width: 62rem) 350px, (max-width: 75rem) 310px, 550px"
               alt="Cyberpunk 2077's Latest Patch Continues to Try and Make the Game Run Better on Console - IGN News"></a>
            <a href="./bayonetta-3-is-progressing-well-despite-its-no-show-at-e3-2021-nintendo-says" class="title"><h2>Bayonetta 3 Is 'Progressing Well' Despite Its No Show at E3 2021, Nintendo Says</h2></a>
            <time datetime="2021-06-11T11:11:00">18.06.2021 11:11</time>
            <a href="./bayonetta-3-is-progressing-well-despite-its-no-show-at-e3-2021-nintendo-says" class="description">Cyberpunk 2077 has just released its latest patch, 1.23 - and it makes clear that CD Projekt Red is continuing to work on getting the game to perform better on consoles.</a>
            <a href="./bayonetta-3-is-progressing-well-despite-its-no-show-at-e3-2021-nintendo-says" class="more">Continue Reading</a>
        </article>

        <article>
            <a href="./ps5-users-can-now-sign-up-to-test-new-features-early" class="cover"><img src="./images/06_310.jpg"
                srcset="./images/06_310.jpg 310w, ./images/06_350.jpg 350w, ./images/06_550.jpg 550w, ./images/06_640.jpg 640w"
                sizes="(max-width: 48rem) 550px, (max-width: 62rem) 350px, (max-width: 75rem) 310px, 550px"
                alt="PS5 Users Can Now Sign Up to Test New Features Early"></a>
            <a href="./ps5-users-can-now-sign-up-to-test-new-features-early" class="title"><h2>PS5 Users Can Now Sign Up to Test New Features Early</h2></a>
            <time datetime="2021-06-11T04:11:00">17.06.2021 04:11</time>
            <a href="./ps5-users-can-now-sign-up-to-test-new-features-early" class="description">Registrations are now open for the PS5 System Software Beta Program.</a>
            <a href="./ps5-users-can-now-sign-up-to-test-new-features-early" class="more">Continue Reading</a>
        </article>
    </div>

    <a href="#" id="load-more">Load More</a>
</main>

<footer>

    <div class="inner">

        <div class="main">
            <h3><a href="./index.html">Gaming News</a></h3>

            <ul class="social">
                <li><a href="#"><img src="./images/icons/001-facebook.svg" alt="facebook"></a></li>
                <li><a href="#"><img src="./images/icons/013-twitter.svg" alt="twitter"></a></li>
                <li><a href="#"><img src="./images/icons/008-youtube.svg" alt="youtube"></a></li>
            </ul>

            <p>Copyright, 2021</p>
        </div>

        <div class="nav">
            <h3>Main Navigation</h3>

            <ul>
                <li><a href="./index.html">Home</a></li>
                <li><a href="./category/pc">PC</a></li>
                <li><a href="./category/playstation">Playstation</a></li>
                <li><a href="./category/nintendo">Nintendo</a></li>
            </ul>
        </div>

    </div>

</footer>

<script>
class Post {
    id;
    title;
    alias;
    description;
    author;
    publishDate;
    category;
    cover;

    constructor() {

    }
    getId() {
        return this.id;
    }
    setId( id ) {
        this.id = parseInt( id );
    }
    getTitle() {
        return this.title;
    }
    setTitle( title ) {
        this.title = title.toString();
    }
    getAlias() {
        return this.alias;
    }
    setAlias( alias ) {
        this.alias = alias.toString();
    }
    getDescription() {
        return this.description;
    }
    setDescription( description ) {
        this.description = description.toString();
    }
    getAuthor() {
        return this.author;
    }
    setAuthor( author ) {
        this.author = author instanceof Author ? author : null;
    }
    getPublishDate( format ) {
        switch( format )
        {
            case 'iso':
                return this.publishDate.toISOString();

            default:
                // отримання дати та часу у форматі "DD.MM.YYYY HH:MM"
                return ( "0" + this.publishDate.getDate() ).slice( -2 ) + "."
                    + ( "0" + ( this.publishDate.getMonth() + 1 ) ).slice( -2 ) + "."
                    + this.publishDate.getFullYear()
                    + " "
                    + ( "0" + this.publishDate.getHours() ).slice( -2 ) + ":"
                    + ( "0" + this.publishDate.getMinutes() ).slice( -2 );
        }
    }
    setPublishDate( publishDate ) {
        this.publishDate = publishDate instanceof Date ? publishDate : new Date( publishDate );
    }
    getCategory() {
        return this.category;
    }
    setCategory( category ) {
        this.category = category instanceof Category ? category : null;
    }
    getCover() {
        return this.cover;
    }
    setCover( cover ) {
        this.cover = cover instanceof Cover ? cover : null;
    }
    getUrl() {
        return './' + this.alias;
    }
}

class User {
    id;
    firstName;
    lastName;

    constructor() {

    }
    getId(){
        return this.id;
    }
    setId( id ) {
        this.id = parseInt( id );
    }
    getFirstName() {
        return this.firstName;
    }
    setFirstName( firstName ) {
        this.firstName = firstName.toString();
    }
    getLastName() {
        return this.lastName;
    }
    setLastName( lastName ) {
        this.lastName = lastName.toString();
    }
}

class Author extends User {
    getUrl() {
        return './author.php?id=' + this.id;
    }
}

class Category {
    id;
    title;
    alias;

    constructor() {

    }
    getId(){
        return this.id;
    }
    setId( id ) {
        this.id = parseInt( id );
    }
    getTitle() {
        return this.title;
    }
    setTitle( title ) {
        this.title = title.toString();
    }
    getAlias() {
        return this.alias;
    }
    setAlias( alias ) {
        this.alias = alias.toString();
    }
    getUrl() {
        return './category.php?alias=' + this.alias;
    }
}

class Cover {
    src;
    srcset;
    sizes;
    alt;

    constructor() {

    }
    getSrc() {
        return this.src;
    }
    setSrc( src ) {
        this.src = src.toString();
    }
    getSrcSet() {
        return this.srcset;
    }
    setSrcSet( srcset ) {
        this.srcset = srcset.toString();
    }
    getSizes() {
        return this.sizes;
    }
    setSizes( sizes ) {
        this.sizes = sizes.toString();
    }
    getAlt() {
        return this.alt;
    }
    setAlt( alt ) {
        this.alt = alt.toString();
    }
}

const createPostInstance = ( data ) =>
{
    // створюємо екземпляр класа Cover та заповнюємо даними
    const cover = new Cover();
    cover.setSrc( data.cover.src );
    cover.setSrcSet( data.cover.srcset );
    cover.setSizes( '(max-width: 48rem) 550px, (max-width: 62rem) 350px, (max-width: 75rem) 310px, 550px' );
    cover.setAlt( data.title );

    // створюємо екземпляр класа Category та заповнюємо даними
    const category = new Category();
    category.setId( data.category.id );
    category.setTitle( data.category.title );
    category.setAlias( data.category.alias );

    // створюємо екземпляр класа Post та заповнюємо даними
    const post = new Post();
    post.setId( data.id );
    post.setTitle( data.title );
    post.setAlias( data.alias );
    post.setDescription( data.description );
    post.setPublishDate( data.publish_date );
    post.setCover( cover );                     // встановлюємо заповнений даними екземпляр класа Cover у екземпляр класа Post
    post.setCategory( category );               // встановлюємо заповнений даними екземпляр класа Category у екземпляр класа Post

    return post;
};

const createPostElement = ( post ) =>
{
    // створюємо елемент <article>
    const el_article       = document.createElement( 'article' );

    // створюємо елемент a.cover
    const el_a_cover       = document.createElement( 'a' );
    el_a_cover.setAttribute( 'class', 'cover' );
    el_a_cover.setAttribute( 'href', post.getUrl() );

    const el_a_cover_img   = document.createElement( 'img' );
    el_a_cover_img.setAttribute( 'src', post.getCover().getSrc() );
    el_a_cover_img.setAttribute( 'srcset', post.getCover().getSrcSet() );
    el_a_cover_img.setAttribute( 'sizes', post.getCover().getSizes() );
    el_a_cover_img.setAttribute( 'alt', post.getTitle() );

    el_a_cover.append( el_a_cover_img );

    // створюємо елемент a.title
    const el_a_title       = document.createElement( 'a' );
    el_a_title.setAttribute( 'class', 'title' );
    el_a_title.setAttribute( 'href', post.getUrl() );

    const el_a_title_h2   = document.createElement( 'h2' );
    el_a_title_h2.append(
        document.createTextNode( post.getTitle() )
    );

    el_a_title.append( el_a_title_h2 );

    // створюємо елемент time
    const el_time       = document.createElement( 'time' );
    el_time.setAttribute( 'datetime', post.getPublishDate( 'iso' ) );

    el_time.append(
        document.createTextNode(
            post.getPublishDate()
        )
    );

    // створюємо елемент a.description
    const el_a_description       = document.createElement( 'a' );
    el_a_description.setAttribute( 'class', 'description' );
    el_a_description.setAttribute( 'href', post.getUrl() );
    el_a_description.append(
        document.createTextNode( post.getDescription() )
    );

    // створюємо елемент a.more
    const el_a_more       = document.createElement( 'a' );
    el_a_more.setAttribute( 'class', 'more' );
    el_a_more.setAttribute( 'href', post.getUrl() );
    el_a_more.append(
        document.createTextNode( 'Continue Reading' )
    );

    // додаємо всі створені елементи до загального елементу <article>
    el_article.append(
        el_a_cover,
        el_a_title,
        el_time,
        el_a_description,
        el_a_more
    );

    // повертаємо елемент <article>
    return el_article;
};

const loadMorePosts = async ( event ) =>
{
    event.preventDefault();         // https://developer.mozilla.org/ru/docs/Web/API/Event/preventDefault
    // "Вызов preventDefault на любой стадии выполнения  потока событий отменяет событие, а это означает,
    // что любое действие по умолчанию обычно принимается реализацией, как  результат события, которое не произойдёт."

    // GET-запит для posts.json, що буде завантажуватись з поточного домена
    let response = await fetch( './posts.json' );

    if( response.ok )           // HTTP = 200, все ОК
    {
        const postsData = await response.json();   // читаємо відповідь в форматі JSON

        if( !postsData )        // якщо дані відсутні
        {
            return false;
        }

        const postsElements = postsData.map(
            ( data ) =>
            {
                const post = createPostInstance( data );

                return createPostElement( post );
            }
        );

        // відображаємо створені елементи з масиву елементів postsElements
        document.getElementsByClassName('posts')[0].append( ...postsElements );
        // "..." - це оператор spread
        // https://learn.javascript.ru/rest-parameters-spread-operator#spread-operator
        // https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Operators/Spread_syntax

        // видаляємо кнопку "Load More", бо ми знаємо що більше постів не буде
        document.getElementById('load-more').remove();
    }
    else
    {                       // HTTP не 200, обробляємо як помилку
        console.error( 'Сталася помилка ' + response.status + ': ' + response.statusText );
    }

    return false;       // і хоч у нас є на початку "event.preventDefault()", але для недобраузерів краще і явно повернути false також.
};

document.getElementById( 'load-more' ).onclick = loadMorePosts;
</script>

</body>
</html>